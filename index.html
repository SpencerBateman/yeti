<head>
  <style>
    body { margin: 0; }
    #canvas {width:100%; height: 100vh}
    #overlay {width:100%; height: 100vh; position: absolute; top: 0; pointer-events: none;}
    #sidebar {width: 30%; height: 100vh; background: white; pointer-events: auto;}
  </style>
</head>
<body>
<div id='canvas' ></div>
<div id='overlay'>
  <div id='sidebar'></div>
</div>

<script type="module" defer>

  /**
  * Imports for Three JS
  *
  **/
  import * as THREE from 'https://unpkg.com/three/build/three.module.js'
  import { GLTFLoader } from 'https://unpkg.com/three/examples/jsm/loaders/GLTFLoader.js';
  import { OrbitControls } from 'https://unpkg.com/three/examples/jsm/controls/OrbitControls.js';

  /**
  * CONSTANTS
  *
  */
  const MOCK_SCALE = 15;
  const CAMERA_START_X = 0;
  const CAMERA_START_Y = .5;
  const CAMERA_START_Z = -1;

  const X_SPEED =.1;
  const Y_SPEED =.1;

  const BG_COLOR = new THREE.Color(0x87ceeb);

  const Loader = new GLTFLoader();

  const RADIUS = 10;

  var vector3 = new THREE.Vector3();

  /**
  * Define variables that will be loaded with data
  *
  */
  let camera, scene, renderer, geometry, material, mesh, light, controls, playerControls, direction, camDirection;
  let PlayerDirectionVector = new THREE.Vector3();

  const rotSpeed = .1;
  const moveSpeed = .5;

  init();
  animate();

  /**
  *
  * Function to setup the scene
  *
  **/
  function init() {

    // Create Scene and add Background Color
    scene = new THREE.Scene();
    scene.background = BG_COLOR;

    // SETUP THE CAMERA
    camera = new THREE.PerspectiveCamera( 100, window.innerWidth / window.innerHeight, 0.01, 1000 );
    camera.position.set(CAMERA_START_X, CAMERA_START_Y, CAMERA_START_Z);

    // SETUP THE LIGHTING
    light = new THREE.HemisphereLight(0x87ceeb, 0xff0000, .5);
    scene.add(light);

    // SETUP PLAYER
    geometry = new THREE.BoxGeometry( 0.2, 0.2, 0.2 );
    material = new THREE.MeshPhongMaterial({color: '#8AC'});
    mesh     = new THREE.Mesh( geometry, material );

    scene.add( mesh );

    Loader.load( 'models/mock1.glb', function ( gltf ) {

      gltf.scene.scale.set(MOCK_SCALE, MOCK_SCALE, MOCK_SCALE);

      scene.add( gltf.scene );

    }, undefined, function ( error ) {

      console.error( error );

    });

    mesh.position.set(0, 1, 0);

    renderer = new THREE.WebGLRenderer( { antialias: true } );

    renderer.setSize( window.innerWidth, window.innerHeight );

    // Controls for Camera
    controls = new OrbitControls(camera, renderer.domElement);
    controls.target = mesh.position;
    controls.minDistance = 1;
  	controls.maxDistance = 2;
    controls.enablePan = false;

    // Controls for Player
    playerControls = new OrbitControls(mesh, renderer.domElement);
    playerControls.target = mesh.position;

    document.getElementById('canvas').appendChild( renderer.domElement );
  }

  function animate() {
    controls.update();

    // Player rotation
    camera.getWorldDirection(vector3);
    console.log(vector3.x);

    mesh.rotation.set(0, vector3.x, 0);

    requestAnimationFrame( animate );
    renderer.render( scene, camera );
  }

  // ADD THE EVENT LISTENER
  document.addEventListener("keydown", onDocumentKeyDown, false);

  // KEYBOARD MANAGER
  // ON KEY EVENT MOVE THE PLAYER AND THE CAMERA
  function onDocumentKeyDown(event) {
    let keyCode = event.which;
    direction = mesh.getWorldDirection();

    // W KEY -- Forward
    if (keyCode == 87) {
      mesh.position.add(direction.multiplyScalar(moveSpeed));

    // A KEY -- Left
    } else if (keyCode == 65) {
      mesh.rotation.y += X_SPEED;

    // D KEY -- Right
    } else if (keyCode == 68) {
      mesh.rotation.y -= X_SPEED;

    // S KEY -- Backwards
    } else if (keyCode == 83) {
      mesh.position.add(direction.multiplyScalar(moveSpeed).multiplyScalar(-1));
    }
  };
</script>
</body>
